from flask import Flask, render_template, request, flash, redirect, url_for, abortfrom projectDB import app, db from projectDB.sign_up.forms import SignUpForm@app.route("/signup" , methods=["GET","POST"])def signup():    form=SignUpForm()    try:        cur = db.connection.cursor()        cur.execute('SELECT name FROM Schools;')        L=[i[0] for i in cur.fetchall()]          form.schools.choices = L    except Exception as e: ## OperationalError        flash(str(e), "danger")            if(request.method == "POST" and form.validate_on_submit()):        personnal_information = form.__dict__        first_name=personnal_information["first_name"].data        last_name=personnal_information["last_name"].data        birth_date=personnal_information["birth_date"].data        email=personnal_information["email"].data        username=personnal_information["username"].data        password=personnal_information["password"].data        role=personnal_information["role"].data        school_name=personnal_information["schools"].data        query="SELECT email FROM Users"        cur.execute(query)        list_email=[i[0] for i in cur.fetchall()]          query="SELECT username FROM Users"        cur.execute(query)        list_username=[i[0] for i in cur.fetchall()]          if email in list_email:            cur.close()            error_email="Mail already exists"            flash(error_email,"danger")        elif username in list_username:            cur.close()            error_username="Username already exists"            flash(error_username,"danger")        else:            query=f"SELECT id_school FROM Schools WHERE name = '{school_name}'"            cur.execute(query)            school_id=cur.fetchone()            school_id=list(school_id)[0]            cur = db.connection.cursor()            query=f"INSERT INTO Users (first_name, last_name, birth_date, email, username, password, approved, Roles_role, Schools_id_school) VALUES ('{first_name}', '{last_name}', '{birth_date}', '{email}', '{username}', '{password}', '0', '{role}', '{school_id}');"            cur.execute(query)            db.connection.commit()            cur.close()            flash("Request sent","success")            return redirect(url_for("index"))    return render_template("signup.html",form = form)        